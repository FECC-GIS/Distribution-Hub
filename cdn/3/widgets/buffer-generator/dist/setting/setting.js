System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector"],function(e,t){var i={},n={},o={},l={},a={};return Object.defineProperty(n,"__esModule",{value:!0}),{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})},function(e){o.Option=e.Option,o.Select=e.Select,o.TextInput=e.TextInput},function(e){l.MapWidgetSelector=e.MapWidgetSelector,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection},function(e){a.DataSourceSelector=e.DataSourceSelector}],execute:function(){e((()=>{var e={89:e=>{"use strict";e.exports=a},244:e=>{"use strict";e.exports=n},298:e=>{"use strict";e.exports=l},321:e=>{"use strict";e.exports=o},386:e=>{"use strict";e.exports=i}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var s={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(s),r.d(s,{__set_webpack_public_path__:()=>c,default:()=>u});var e=r(386),t=r(244),i=r(321),n=r(298),o=r(89),l=function(e,t,i,n){return new(i||(i=Promise))(function(o,l){function a(e){try{s(n.next(e))}catch(e){l(e)}}function r(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}s((n=n.apply(e,t||[])).next())})};function a(e){return e?"function"==typeof e.asMutable?e.asMutable({deep:!0}):e:[]}function u(s){var u,c,d,g;const v=s.config,f=a(s.useDataSources),S=f[0]?[f[0]]:[],p=f.length>1?f.slice(1):[],[h,m]=t.React.useState([]),y=e=>{s.onSettingChange({id:s.id,useDataSourcesEnabled:e})},b=e=>l(this,void 0,void 0,function*(){var t,i,n;try{if(!e)return void m([]);const{DataSourceManager:o}=yield Promise.resolve().then(r.bind(r,244)),l=o.getInstance().getDataSource(e),a=null===(t=null==l?void 0:l.getSchema)||void 0===t?void 0:t.call(l),u=null!==(i=null==a?void 0:a.fields)&&void 0!==i?i:{},c=Object.keys(u).map(e=>{const t=u[e];return{name:e,alias:null==t?void 0:t.alias,type:null==t?void 0:t.type}}).filter(e=>e.name&&"shape"!==e.name.toLowerCase()&&"geometry"!==e.name.toLowerCase()).sort((e,t)=>{const i=(e.type||"").toString().toLowerCase().includes("string")?0:1,n=(t.type||"").toString().toLowerCase().includes("string")?0:1;return i!==n?i-n:e.name.localeCompare(t.name)});m(c);if(!(null===(n=s.config)||void 0===n?void 0:n.vehicleDisplayField)){const e=c.find(e=>(e.type||"").toString().toLowerCase().includes("string"));(null==e?void 0:e.name)&&s.onSettingChange({id:s.id,config:s.config.set("vehicleDisplayField",e.name)})}}catch(e){m([])}});return t.React.useEffect(()=>{var e;const t=null===(e=null==S?void 0:S[0])||void 0===e?void 0:e.dataSourceId;b(t)},[]),(0,e.jsxs)("div",{style:{padding:12},children:[(0,e.jsx)(n.SettingSection,{title:"Widget",children:(0,e.jsx)(n.SettingRow,{label:"Widget title",flow:"wrap",children:(0,e.jsx)(i.TextInput,{style:{width:"100%"},value:null!==(u=null==v?void 0:v.widgetTitle)&&void 0!==u?u:"",onChange:e=>{s.onSettingChange({id:s.id,config:s.config.set("widgetTitle",e.target.value)})},placeholder:"Leave blank to use the widget name"})})}),(0,e.jsx)(n.SettingSection,{title:"Map",children:(0,e.jsx)(n.SettingRow,{label:"Map widget",flow:"wrap",children:(0,e.jsx)(n.MapWidgetSelector,{useMapWidgetIds:s.useMapWidgetIds,onSelect:e=>{s.onSettingChange({id:s.id,useMapWidgetIds:(0,t.Immutable)(e)})}})})}),(0,e.jsxs)(n.SettingSection,{title:"Vehicle layer",children:[(0,e.jsxs)("div",{style:{width:"100%"},children:[(0,e.jsx)("div",{style:{fontSize:12,marginBottom:6},children:"Data source"}),(0,e.jsx)(o.DataSourceSelector,{widgetId:s.id,types:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSourceTypes:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSources:(0,t.Immutable)(S),useDataSourcesEnabled:s.useDataSourcesEnabled,onToggleUseDataEnabled:y,onChange:e=>l(this,void 0,void 0,function*(){var i;const n=a(e),o=n[0]?[n[0]]:[],l=[...o,...p];s.onSettingChange({id:s.id,useDataSources:(0,t.Immutable)(l)});const r=null===(i=null==o?void 0:o[0])||void 0===i?void 0:i.dataSourceId;yield b(r)}),mustUseDataSource:!0})]}),(0,e.jsx)(n.SettingRow,{label:"Display field",flow:"wrap",children:(0,e.jsxs)(i.Select,{style:{width:"100%"},value:null!==(c=null==v?void 0:v.vehicleDisplayField)&&void 0!==c?c:"",onChange:e=>{s.onSettingChange({id:s.id,config:s.config.set("vehicleDisplayField",e.target.value)})},disabled:0===h.length,children:[(0,e.jsx)(i.Option,{value:"",children:"(auto)"}),h.map(t=>(0,e.jsx)(i.Option,{value:t.name,children:t.alias?`${t.alias} (${t.name})`:t.name},t.name))]})})]}),(0,e.jsxs)(n.SettingSection,{title:"Buffer",children:[(0,e.jsx)(n.SettingRow,{label:"Distance",flow:"wrap",children:(0,e.jsx)(i.TextInput,{style:{width:"100%"},type:"number",value:(null!==(d=null==v?void 0:v.bufferDistance)&&void 0!==d?d:500).toString(),onChange:e=>{const t=Number(e.target.value);s.onSettingChange({id:s.id,config:s.config.set("bufferDistance",isNaN(t)?0:t)})}})}),(0,e.jsx)(n.SettingRow,{label:"Units",flow:"wrap",children:(0,e.jsxs)(i.Select,{style:{width:"100%"},value:null!==(g=null==v?void 0:v.bufferUnit)&&void 0!==g?g:"feet",onChange:e=>{s.onSettingChange({id:s.id,config:s.config.set("bufferUnit",e.target.value)})},children:[(0,e.jsx)(i.Option,{value:"feet",children:"Feet"}),(0,e.jsx)(i.Option,{value:"meters",children:"Meters"}),(0,e.jsx)(i.Option,{value:"miles",children:"Miles"}),(0,e.jsx)(i.Option,{value:"kilometers",children:"Kilometers"})]})})]}),(0,e.jsx)(n.SettingSection,{title:"Target layers (queried inside buffer)",children:(0,e.jsxs)("div",{style:{width:"100%"},children:[(0,e.jsx)("div",{style:{fontSize:12,marginBottom:6},children:"Select one or more layers"}),(0,e.jsx)(o.DataSourceSelector,{widgetId:s.id,types:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSourceTypes:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSources:(0,t.Immutable)(p),useDataSourcesEnabled:s.useDataSourcesEnabled,onToggleUseDataEnabled:y,isMultiple:!0,onChange:e=>l(this,void 0,void 0,function*(){const i=a(e),n=[...S,...i],o=i.map(e=>(null==e?void 0:e.label)||(null==e?void 0:e.dataSourceId)).filter(Boolean),u=yield function(e){return l(this,void 0,void 0,function*(){var t,i,n,o;const{DataSourceManager:l}=yield Promise.resolve().then(r.bind(r,244)),a=l.getInstance(),s=[];for(const l of e){const e=null==l?void 0:l.dataSourceId;if(e)try{const l=a.getDataSource(e),r=null===(t=null==l?void 0:l.getDataSourceJson)||void 0===t?void 0:t.call(l),u=null==r?void 0:r.url,c=(null===(i=null==l?void 0:l.layer)||void 0===i?void 0:i.url)||(null===(o=null===(n=null==l?void 0:l.getLayer)||void 0===n?void 0:n.call(l))||void 0===o?void 0:o.url),d=(u||c||"").toString();s.push(d)}catch(e){s.push("")}else s.push("")}return s})}(i);s.onSettingChange({id:s.id,useDataSources:(0,t.Immutable)(n),config:s.config.set("targetLayerTitles",o).set("targetLayerUrls",u)})})}),(0,e.jsx)("div",{style:{fontSize:11,marginTop:8,opacity:.75},children:"Tip: if results are zero, re-select the target layer(s) once so the widget captures their URLs."})]})})]})}function c(e){r.p=e}})(),s})())}}});