System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","esri/rest/support/Query","esri/geometry/geometryEngine"],function(e,t){var i={},o={},l={},n={},r={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){o.DataSourceComponent=e.DataSourceComponent,o.React=e.React},function(e){l.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){r.default=e.default}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=o},386:e=>{"use strict";e.exports=i},510:e=>{"use strict";e.exports=n},686:e=>{"use strict";e.exports=l},958:e=>{"use strict";e.exports=r}},t={};function d(i){var o=t[i];if(void 0!==o)return o.exports;var l=t[i]={exports:{}};return e[i](l,l.exports,d),l.exports}d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var u={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(u),d.d(u,{__set_webpack_public_path__:()=>s,default:()=>a});var e=d(386),t=d(244),i=d(686),o=d(510),l=d(958),n=function(e,t,i,o){return new(i||(i=Promise))(function(l,n){function r(e){try{u(o.next(e))}catch(e){n(e)}}function d(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?l(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,d)}u((o=o.apply(e,t||[])).next())})};function r(e){const t=Number(e);return Number.isFinite(t)?t:null}function a(d){var u,a,s,c,v,g,p,f,b,y,m,h;const x=function(e){var t,i,o,l,n,r,d,u;const a=null===(t=null==e?void 0:e.useExperienceTheme)||void 0===t||t,s=null!==(i=null==e?void 0:e.padding)&&void 0!==i?i:12,c=null!==(o=null==e?void 0:e.gap)&&void 0!==o?o:10,v=null!==(l=null==e?void 0:e.borderRadius)&&void 0!==l?l:8,g=null!==(n=null==e?void 0:e.borderWidth)&&void 0!==n?n:1,p=null!==(r=null==e?void 0:e.baseFontSize)&&void 0!==r?r:13,f=null!==(d=null==e?void 0:e.titleFontSize)&&void 0!==d?d:15,b=null!==(u=null==e?void 0:e.smallFontSize)&&void 0!==u?u:12,y=(null==e?void 0:e.backgroundColor)||(a?"":"#0b1220"),m=(null==e?void 0:e.panelBackgroundColor)||(a?"":"#0f172a"),h=(null==e?void 0:e.textColor)||(a?"":"#e5e7eb"),x=(null==e?void 0:e.subtleTextColor)||(a?"":"rgba(229,231,235,0.75)"),S=(null==e?void 0:e.borderColor)||(a?"":"rgba(255,255,255,0.14)");return{padding:s,gap:c,radius:v,borderWidth:g,baseFontSize:p,titleFontSize:f,smallFontSize:b,bg:y,panelBg:m,text:h,subtleText:x,border:S,btnBg:(null==e?void 0:e.buttonBackgroundColor)||(a?"":"#111827"),btnText:(null==e?void 0:e.buttonTextColor)||h,btnBorder:(null==e?void 0:e.buttonBorderColor)||S,inputBg:(null==e?void 0:e.inputBackgroundColor)||(a?"":"#0b1220"),inputText:(null==e?void 0:e.inputTextColor)||h,inputBorder:(null==e?void 0:e.inputBorderColor)||S,fontFamily:(null==e?void 0:e.fontFamily)||""}}(null===(u=d.config)||void 0===u?void 0:u.style),[S,j]=t.React.useState(null),[C,w]=t.React.useState(null),[T,F]=t.React.useState(null),[R,B]=t.React.useState([]),[O,k]=t.React.useState(null),[z,D]=t.React.useState(!1),[M,P]=t.React.useState(""),I=null===(a=d.useDataSources)||void 0===a?void 0:a[0],$=null===(s=d.useDataSources)||void 0===s?void 0:s[1],_=null===(c=d.useMapWidgetIds)||void 0===c?void 0:c[0],E=(null!==(g=null===(v=d.config)||void 0===v?void 0:v.territoryNameField)&&void 0!==g?g:"").toString().trim(),W=null!==(f=null===(p=d.config)||void 0===p?void 0:p.spatialRelationship)&&void 0!==f?f:"intersects",J=null!==(y=null===(b=d.config)||void 0===b?void 0:b.maxTerritories)&&void 0!==y?y:2e3,Q=null!==(h=null===(m=d.config)||void 0===m?void 0:m.autoApply)&&void 0!==h&&h,A=function(e){var t;const i=null===(t=e.config)||void 0===t?void 0:t.widgetTitle,o=null==e?void 0:e.label;return i&&String(i).trim()||o&&String(o).trim()||"Territory Filter"}(d),N={padding:x.padding,fontSize:x.baseFontSize,fontFamily:x.fontFamily||void 0,background:x.bg||void 0,color:x.text||void 0},V={background:x.panelBg||void 0,border:`${x.borderWidth}px solid ${x.border||"rgba(0,0,0,0.12)"}`,borderRadius:x.radius,padding:x.padding,marginTop:x.gap},q={padding:"6px 8px",borderRadius:Math.max(6,Math.round(.75*x.radius)),border:`1px solid ${x.inputBorder||x.border||"rgba(0,0,0,0.18)"}`,background:x.inputBg||void 0,color:x.inputText||void 0,width:"100%"},G={padding:"6px 10px",borderRadius:Math.max(6,Math.round(.75*x.radius)),border:`1px solid ${x.btnBorder||x.border||"rgba(0,0,0,0.18)"}`,background:x.btnBg||void 0,color:x.btnText||void 0,cursor:"pointer",fontSize:x.smallFontSize},L=e=>{var t;return(null==e?void 0:e.layer)||(null===(t=null==e?void 0:e.getLayer)||void 0===t?void 0:t.call(e))||null},U=!!I&&!!$,H=t.React.useCallback(()=>n(this,void 0,void 0,function*(){var e,t,i,o,l,n;if(P(""),B([]),k(null),I)if(E)if(C)try{D(!0);const n=C,d=(null===(t=null===(e=null==n?void 0:n.getSchema)||void 0===e?void 0:e.call(n))||void 0===t?void 0:t.idField)||"OBJECTID",u=yield n.query({where:"1=1",outFields:[d,E],returnGeometry:!1,pageSize:Math.min(J,2e3)}),a=(null!==(i=null==u?void 0:u.records)&&void 0!==i?i:[]).map(e=>{var t,i,o,l,n,u,a;const s=null!==(n=null!==(l=null!==(i=null===(t=null==e?void 0:e.getData)||void 0===t?void 0:t.call(e))&&void 0!==i?i:null===(o=null==e?void 0:e.feature)||void 0===o?void 0:o.attributes)&&void 0!==l?l:null==e?void 0:e.attributes)&&void 0!==n?n:{},c=r(null==s?void 0:s[d]);if(null==c)return null;return{oid:c,name:(null!==(a=null!==(u=null==s?void 0:s[E])&&void 0!==u?u:null==s?void 0:s[d])&&void 0!==a?a:c).toString()}}).filter(Boolean);a.sort((e,t)=>e.name.localeCompare(t.name)),B(a),k(null!==(l=null===(o=a[0])||void 0===o?void 0:o.oid)&&void 0!==l?l:null)}catch(e){P(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Failed to load territories.")}finally{D(!1)}else P("Territory data source is not ready yet. Try again in a moment.");else P("Pick a Territory name field in widget settings.");else P("Configure the Territory data source in widget settings.")}),[I,E,J,C]),K=t.React.useCallback(()=>n(this,void 0,void 0,function*(){var e,t,i,n,u,a,s,c,v,g,p,f;if(P(""),!I)return void P("Configure the Territory data source in widget settings.");if(!$)return void P("Configure the Target data source in widget settings.");if(!O)return void P("Select a territory.");if(!C)return void P("Territory data source is not ready yet.");if(!T)return void P("Target data source is not ready yet.");const b=C,y=T,m=L(b),h=L(y);if(m&&h)try{D(!0);const f=(null===(t=null===(e=null==b?void 0:b.getSchema)||void 0===e?void 0:e.call(b))||void 0===t?void 0:t.idField)||m.objectIdField||"OBJECTID",x=(null===(n=null===(i=null==y?void 0:y.getSchema)||void 0===i?void 0:i.call(y))||void 0===n?void 0:n.idField)||h.objectIdField||"OBJECTID",j=new o.default({where:`${f} = ${O}`,outFields:[f],returnGeometry:!0}),C=yield m.queryFeatures(j),w=null===(a=null===(u=null==C?void 0:C.features)||void 0===u?void 0:u[0])||void 0===a?void 0:a.geometry;if(!w)return void P("Could not read territory geometry.");const T=new o.default({where:"1=1",geometry:w,spatialRelationship:"intersects",outFields:[x],returnGeometry:"within"===W}),F=yield h.queryFeatures(T);let R=null!==(s=null==F?void 0:F.features)&&void 0!==s?s:[];"within"===W&&(R=R.filter(e=>{try{return l.default.within(e.geometry,w)}catch(e){return!1}}));const B=R.map(e=>{var t;return r(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t[x])}).filter(e=>null!=e),k=null!==(v=null===(c=y.getQueryParams)||void 0===c?void 0:c.call(y))&&void 0!==v?v:{};if(B.length){const e=900,t=[];for(let i=0;i<B.length;i+=e)t.push(`${x} IN (${B.slice(i,i+e).join(",")})`);const i=1===t.length?t[0]:`(${t.join(" OR ")})`;null===(p=y.updateQueryParams)||void 0===p||p.call(y,Object.assign(Object.assign({},k),{where:i}),d.id)}else null===(g=y.updateQueryParams)||void 0===g||g.call(y,Object.assign(Object.assign({},k),{where:"1=2"}),d.id);(null==S?void 0:S.view)&&(null==w?void 0:w.extent)&&S.view.goTo(w.extent.expand(1.1)).catch(()=>{})}catch(e){P(null!==(f=null==e?void 0:e.message)&&void 0!==f?f:"Apply failed.")}finally{D(!1)}else P("Could not access layer objects.")}),[I,$,O,C,T,W,d.id,S]),X=t.React.useCallback(()=>{var e,t,i;if(P(""),!T)return;const o=T,l=null!==(t=null===(e=o.getQueryParams)||void 0===e?void 0:e.call(o))&&void 0!==t?t:{};null===(i=o.updateQueryParams)||void 0===i||i.call(o,Object.assign(Object.assign({},l),{where:"1=1"}),d.id)},[T,d.id]);return t.React.useEffect(()=>{C&&I&&$&&E&&H()},[C,I,$,E,H]),t.React.useEffect(()=>{Q&&O&&K()},[Q,O,K]),(0,e.jsxs)("div",{style:N,children:[!!_&&(0,e.jsx)(i.JimuMapViewComponent,{useMapWidgetId:_,onActiveViewChange:e=>j(e)}),I&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:I,widgetId:d.id,onDataSourceCreated:e=>w(e)}),$&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:$,widgetId:d.id,onDataSourceCreated:e=>F(e)}),(0,e.jsx)("div",{style:{fontWeight:700,fontSize:x.titleFontSize},children:A}),U?(0,e.jsxs)("div",{style:V,children:[(0,e.jsx)("div",{style:{fontSize:12,color:x.subtleText||void 0,marginBottom:6},children:"Territory"}),(0,e.jsx)("select",{style:q,value:null!=O?O:"",disabled:z||0===R.length,onChange:e=>k(r(e.target.value)),children:R.map(t=>(0,e.jsx)("option",{value:t.oid,children:t.name},t.oid))}),(0,e.jsxs)("div",{style:{display:"flex",gap:8,marginTop:10},children:[(0,e.jsx)("button",{type:"button",style:G,onClick:()=>{K()},disabled:z||!O,children:z?"Working...":"Apply"}),(0,e.jsx)("button",{type:"button",style:G,onClick:X,disabled:z,children:"Clear"})]}),M&&(0,e.jsx)("div",{style:{marginTop:10,fontSize:12,color:"rgb(180,0,0)"},children:M})]}):(0,e.jsx)("div",{style:Object.assign(Object.assign({},V),{fontSize:12}),children:"Configure Territory and Target data sources in the widget settings."})]})}function s(e){d.p=e}})(),u})())}}});