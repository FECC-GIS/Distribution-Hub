System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector"],function(e,t){var l={},n={},o={},a={},i={};return Object.defineProperty(n,"__esModule",{value:!0}),{setters:[function(e){l.jsx=e.jsx,l.jsxs=e.jsxs},function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})},function(e){o.Option=e.Option,o.Select=e.Select,o.Switch=e.Switch,o.TextInput=e.TextInput},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection},function(e){i.DataSourceSelector=e.DataSourceSelector}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=n},298:e=>{"use strict";e.exports=a},321:e=>{"use strict";e.exports=o},386:e=>{"use strict";e.exports=l},470:e=>{"use strict";e.exports=i}},t={};function r(l){var n=t[l];if(void 0!==n)return n.exports;var o=t[l]={exports:{}};return e[l](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var d={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(d),r.d(d,{__set_webpack_public_path__:()=>p,default:()=>g});var e=r(386),t=r(244),l=r(321),n=r(298),o=r(470),a=function(e,t,l,n){return new(l||(l=Promise))(function(o,a){function i(e){try{d(n.next(e))}catch(e){a(e)}}function r(e){try{d(n.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(i,r)}d((n=n.apply(e,t||[])).next())})};function i(e){return e?"function"==typeof e.asMutable?e.asMutable({deep:!0}):e:[]}function u(e,t,l){e.onSettingChange({id:e.id,config:e.config.set(t,l)})}function s(e,l,n){var o;const a=(null===(o=e.config)||void 0===o?void 0:o.style)||(0,t.Immutable)({});e.onSettingChange({id:e.id,config:e.config.set("style",a.set(l,n))})}function c(t){const{label:o,value:a,placeholder:i,disabled:r,onChange:d,onClear:u}=t,s=function(e,t="#000000"){if(!e)return t;const l=e.trim();return function(e){if(!e)return!1;const t=e.trim();return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)}(l)?l.slice(0,7):t}(a,"#000000"),c=!!a&&a.trim().startsWith("rgba");return(0,e.jsxs)(n.SettingRow,{label:o,flow:"wrap",children:[(0,e.jsxs)("div",{style:{width:"100%",display:"grid",gridTemplateColumns:"44px 1fr auto",gap:8,alignItems:"center"},children:[(0,e.jsx)("input",{type:"color",value:s,disabled:r,onChange:e=>d(e.target.value),style:{width:44,height:32,padding:0,border:"none",background:"transparent"}}),(0,e.jsx)(l.TextInput,{style:{width:"100%"},value:null!=a?a:"",disabled:r,onChange:e=>d(e.target.value),placeholder:i}),(0,e.jsx)("button",{type:"button",onClick:u,disabled:r,style:{padding:"6px 10px",borderRadius:6,border:"1px solid rgba(0,0,0,0.2)",background:"transparent",cursor:r?"default":"pointer"},title:"Clear to let the theme or defaults apply",children:"Clear"})]}),c&&(0,e.jsx)("div",{style:{width:"100%",marginTop:6,fontSize:12,opacity:.8},children:"Tip: The color picker only edits hex values. Keep rgba values for transparency, or click Clear and let the theme handle it."})]})}function g(d){var g,p,h,v,b,x,S,f,m,C,y,w;const j=d.config,T=null==j?void 0:j.style,I=i(d.useDataSources),R=I[0]?[I[0]]:[],k=I[1]?[I[1]]:[],[D,E]=t.React.useState([]),[B,F]=t.React.useState([]),L=e=>{d.onSettingChange({id:d.id,useDataSourcesEnabled:e})},O=(e,t,...l)=>a(this,[e,t,...l],void 0,function*(e,t,l=!1){var n,o;try{if(!e||!t)return void(null==t||t([]));const{DataSourceManager:a}=yield Promise.resolve().then(r.bind(r,244)),i=a.getInstance().getDataSource(e),d=null===(n=null==i?void 0:i.getSchema)||void 0===n?void 0:n.call(i),u=null!==(o=null==d?void 0:d.fields)&&void 0!==o?o:{},s=Object.keys(u).map(e=>{const t=u[e];return{name:e,alias:null==t?void 0:t.alias,type:null==t?void 0:t.type}});t(s.filter(e=>e.name&&"shape"!==e.name.toLowerCase()&&"geometry"!==e.name.toLowerCase()).sort((e,t)=>{const n=(e.type||"").toString().toLowerCase().includes("string")?0:1,o=(t.type||"").toString().toLowerCase().includes("string")?0:1;return l&&n!==o?n-o:e.name.localeCompare(t.name)}))}catch(e){null==t||t([])}}),A=()=>{d.useDataSourcesEnabled||d.onSettingChange({id:d.id,useDataSourcesEnabled:!0})};t.React.useEffect(()=>{var e,t;const l=null===(e=null==R?void 0:R[0])||void 0===e?void 0:e.dataSourceId,n=null===(t=null==k?void 0:k[0])||void 0===t?void 0:t.dataSourceId;O(l,E,!0),O(n,F,!1)},[]);const M=null===(g=null==T?void 0:T.useExperienceTheme)||void 0===g||g,_=M;return(0,e.jsxs)("div",{style:{padding:12},children:[(0,e.jsxs)(n.SettingSection,{title:"Widget",children:[(0,e.jsx)(n.SettingRow,{label:"Widget title",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},value:null!==(p=null==j?void 0:j.widgetTitle)&&void 0!==p?p:"",onChange:e=>u(d,"widgetTitle",e.target.value),placeholder:"Leave blank to use widget name"})}),(0,e.jsx)(n.SettingRow,{label:"Auto apply on change",flow:"wrap",children:(0,e.jsxs)("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,e.jsx)("div",{style:{fontSize:12,opacity:.8},children:"Runs Apply automatically when territory changes"}),(0,e.jsx)(l.Switch,{checked:null!==(h=null==j?void 0:j.autoApply)&&void 0!==h&&h,onChange:e=>u(d,"autoApply",e.target.checked)})]})})]}),(0,e.jsx)(n.SettingSection,{title:"Map",children:(0,e.jsx)(n.SettingRow,{label:"Map widget",flow:"wrap",children:(0,e.jsx)(n.MapWidgetSelector,{useMapWidgetIds:d.useMapWidgetIds,onSelect:e=>{d.onSettingChange({id:d.id,useMapWidgetIds:(0,t.Immutable)(e)})}})})}),(0,e.jsxs)(n.SettingSection,{title:"Territory layer (polygons)",children:[(0,e.jsxs)("div",{style:{width:"100%"},children:[(0,e.jsx)("div",{style:{fontSize:12,marginBottom:6},children:"Data source"}),(0,e.jsx)(o.DataSourceSelector,{widgetId:d.id,types:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSourceTypes:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSources:(0,t.Immutable)(R),useDataSourcesEnabled:d.useDataSourcesEnabled,onToggleUseDataEnabled:L,onChange:e=>a(this,void 0,void 0,function*(){var l,n,o;A();const a=i(e),r=a[0]?[a[0]]:[],s=[...r,...k];d.onSettingChange({id:d.id,useDataSources:(0,t.Immutable)(s)});const c=null===(l=null==r?void 0:r[0])||void 0===l?void 0:l.dataSourceId;yield O(c,E,!0);if(!(null===(n=d.config)||void 0===n?void 0:n.territoryNameField)){const e=null===(o=D.find(e=>(e.type||"").toString().toLowerCase().includes("string")))||void 0===o?void 0:o.name;u(d,"territoryNameField",e||"Description")}}),mustUseDataSource:!0})]}),(0,e.jsx)(n.SettingRow,{label:"Territory name field",flow:"wrap",children:(0,e.jsxs)(l.Select,{style:{width:"100%"},value:null!==(v=null==j?void 0:j.territoryNameField)&&void 0!==v?v:"",onChange:e=>u(d,"territoryNameField",e.target.value),disabled:0===D.length,children:[(0,e.jsx)(l.Option,{value:"",children:"(choose field)"}),D.map(t=>(0,e.jsx)(l.Option,{value:t.name,children:t.alias?`${t.alias} (${t.name})`:t.name},t.name))]})}),(0,e.jsx)(n.SettingRow,{label:"Max territories to load",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},type:"number",value:String(null!==(b=null==j?void 0:j.maxTerritories)&&void 0!==b?b:2e3),onChange:e=>u(d,"maxTerritories",Number(e.target.value)||2e3)})})]}),(0,e.jsxs)(n.SettingSection,{title:"Target layer (Primary Conductor)",children:[(0,e.jsxs)("div",{style:{width:"100%"},children:[(0,e.jsx)("div",{style:{fontSize:12,marginBottom:6},children:"Data source"}),(0,e.jsx)(o.DataSourceSelector,{widgetId:d.id,types:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSourceTypes:(0,t.Immutable)(["FEATURE_LAYER"]),useDataSources:(0,t.Immutable)(k),useDataSourcesEnabled:d.useDataSourcesEnabled,onToggleUseDataEnabled:L,onChange:e=>a(this,void 0,void 0,function*(){var l,n,o;A();const a=i(e),r=a[0]?[a[0]]:[],s=[...R,...r];d.onSettingChange({id:d.id,useDataSources:(0,t.Immutable)(s)});const c=null===(l=null==r?void 0:r[0])||void 0===l?void 0:l.dataSourceId;yield O(c,F,!1);if(!(null===(n=d.config)||void 0===n?void 0:n.targetLengthField)){const e=null===(o=B.find(e=>{const t=(e.type||"").toString().toLowerCase();return t.includes("double")||t.includes("integer")||t.includes("number")||t.includes("long")}))||void 0===o?void 0:o.name;u(d,"targetLengthField",e||"")}}),mustUseDataSource:!0})]}),(0,e.jsx)(n.SettingRow,{label:"Length field (for total)",flow:"wrap",children:(0,e.jsxs)(l.Select,{style:{width:"100%"},value:null!==(x=null==j?void 0:j.targetLengthField)&&void 0!==x?x:"",onChange:e=>u(d,"targetLengthField",e.target.value),disabled:0===B.length,children:[(0,e.jsx)(l.Option,{value:"",children:"(none)"}),B.map(t=>(0,e.jsx)(l.Option,{value:t.name,children:t.alias?`${t.alias} (${t.name})`:t.name},t.name))]})}),(0,e.jsx)(n.SettingRow,{label:"Spatial relationship",flow:"wrap",children:(0,e.jsxs)(l.Select,{style:{width:"100%"},value:null!==(S=null==j?void 0:j.spatialRelationship)&&void 0!==S?S:"intersects",onChange:e=>u(d,"spatialRelationship",e.target.value),children:[(0,e.jsx)(l.Option,{value:"intersects",children:"Intersects"}),(0,e.jsx)(l.Option,{value:"within",children:"Within"})]})})]}),(0,e.jsxs)(n.SettingSection,{title:"Style",children:[(0,e.jsx)(n.SettingRow,{label:"Use Experience theme",flow:"wrap",children:(0,e.jsxs)("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,e.jsx)("div",{style:{fontSize:12,opacity:.8},children:"When enabled, most colors and fonts inherit from the Experience. Turn off to fully customize."}),(0,e.jsx)(l.Switch,{checked:M,onChange:e=>s(d,"useExperienceTheme",e.target.checked)})]})}),(0,e.jsx)(n.SettingRow,{label:"Font family",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},value:null!==(f=null==T?void 0:T.fontFamily)&&void 0!==f?f:"",disabled:_,onChange:e=>s(d,"fontFamily",e.target.value)})}),(0,e.jsx)(n.SettingRow,{label:"Base font size (px)",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},type:"number",value:String(null!==(m=null==T?void 0:T.baseFontSize)&&void 0!==m?m:13),disabled:_,onChange:e=>s(d,"baseFontSize",Number(e.target.value)||13)})}),(0,e.jsx)(n.SettingRow,{label:"Title font size (px)",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},type:"number",value:String(null!==(C=null==T?void 0:T.titleFontSize)&&void 0!==C?C:15),disabled:_,onChange:e=>s(d,"titleFontSize",Number(e.target.value)||15)})}),(0,e.jsx)(n.SettingRow,{label:"Border radius (px)",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},type:"number",value:String(null!==(y=null==T?void 0:T.borderRadius)&&void 0!==y?y:8),disabled:_,onChange:e=>s(d,"borderRadius",Number(e.target.value)||8)})}),(0,e.jsx)(n.SettingRow,{label:"Padding (px)",flow:"wrap",children:(0,e.jsx)(l.TextInput,{style:{width:"100%"},type:"number",value:String(null!==(w=null==T?void 0:T.padding)&&void 0!==w?w:12),disabled:_,onChange:e=>s(d,"padding",Number(e.target.value)||12)})}),(0,e.jsx)(c,{label:"Background color",value:null==T?void 0:T.backgroundColor,placeholder:"#0b1220",disabled:_,onChange:e=>s(d,"backgroundColor",e),onClear:()=>s(d,"backgroundColor","")}),(0,e.jsx)(c,{label:"Panel background color",value:null==T?void 0:T.panelBackgroundColor,placeholder:"#0f172a",disabled:_,onChange:e=>s(d,"panelBackgroundColor",e),onClear:()=>s(d,"panelBackgroundColor","")}),(0,e.jsx)(c,{label:"Text color",value:null==T?void 0:T.textColor,placeholder:"#e5e7eb",disabled:_,onChange:e=>s(d,"textColor",e),onClear:()=>s(d,"textColor","")}),(0,e.jsx)(c,{label:"Subtle text color",value:null==T?void 0:T.subtleTextColor,placeholder:"rgba(229,231,235,0.75)",disabled:_,onChange:e=>s(d,"subtleTextColor",e),onClear:()=>s(d,"subtleTextColor","")}),(0,e.jsx)(c,{label:"Border color",value:null==T?void 0:T.borderColor,placeholder:"rgba(255,255,255,0.14)",disabled:_,onChange:e=>s(d,"borderColor",e),onClear:()=>s(d,"borderColor",""),onClear:()=>s(d,"borderColor","")}),(0,e.jsx)(c,{label:"Accent color",value:null==T?void 0:T.accentColor,placeholder:"#60a5fa",disabled:_,onChange:e=>s(d,"accentColor",e),onClear:()=>s(d,"accentColor","")}),(0,e.jsx)(c,{label:"Button background",value:null==T?void 0:T.buttonBackgroundColor,placeholder:"#111827",disabled:_,onChange:e=>s(d,"buttonBackgroundColor",e),onClear:()=>s(d,"buttonBackgroundColor","")}),(0,e.jsx)(c,{label:"Button text",value:null==T?void 0:T.buttonTextColor,placeholder:"#e5e7eb",disabled:_,onChange:e=>s(d,"buttonTextColor",e),onClear:()=>s(d,"buttonTextColor","")}),(0,e.jsx)(c,{label:"Button border",value:null==T?void 0:T.buttonBorderColor,placeholder:"rgba(255,255,255,0.14)",disabled:_,onChange:e=>s(d,"buttonBorderColor",e),onClear:()=>s(d,"buttonBorderColor","")}),(0,e.jsx)(c,{label:"Input background",value:null==T?void 0:T.inputBackgroundColor,placeholder:"#0b1220",disabled:_,onChange:e=>s(d,"inputBackgroundColor",e),onClear:()=>s(d,"inputBackgroundColor","")}),(0,e.jsx)(c,{label:"Input text",value:null==T?void 0:T.inputTextColor,placeholder:"#e5e7eb",disabled:_,onChange:e=>s(d,"inputTextColor",e),onClear:()=>s(d,"inputTextColor","")}),(0,e.jsx)(c,{label:"Input border",value:null==T?void 0:T.inputBorderColor,placeholder:"rgba(255,255,255,0.14)",disabled:_,onChange:e=>s(d,"inputBorderColor",e),onClear:()=>s(d,"inputBorderColor","")})]})]})}function p(e){r.p=e}})(),d})())}}});